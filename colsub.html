<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soluci√≥n Auditor√≠a IA - Dispensaci√≥n Farmac√©utica</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <!-- Chosen Palette: Slate & Blue (Tech/Corporate) - Minimalistic and professional context for AI Engineering -->
    <!-- Application Structure Plan:
        1. Hero Section: Title and Context.
        2. KPI Dashboard: High-level metrics from the "Reporte de Resultados".
        3. Interactive Architecture Flow: Transforms the text/Mermaid flow into clickable steps to understand the data pipeline.
        4. Validation Lab: Displays the processed files table with drill-down details for the specific errors found (File 2 & 3).
        5. Tech Spec: Tabs to view the Prompt and JSON Schema.
        6. Business Impact: Charts showing efficiency gains.
        Rationale: Moves from "What happened" (Results) to "How it works" (Architecture) to "Why it matters" (Impact).
    -->
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1e293b; }
        .chart-container { 
            position: relative; 
            width: 100%; 
            max-width: 600px; 
            margin-left: auto; 
            margin-right: auto; 
            height: 300px; 
            max-height: 400px; 
        }
        @media (min-width: 768px) { .chart-container { height: 350px; } }
        
        .step-card { transition: all 0.3s ease; cursor: pointer; border-left: 4px solid transparent; }
        .step-card:hover, .step-card.active { border-left-color: #3b82f6; background-color: #eff6ff; }
        .tab-btn.active { border-bottom: 2px solid #3b82f6; color: #3b82f6; font-weight: 600; }
        
        /* Custom scrollbar for code blocks */
        .code-scroll::-webkit-scrollbar { height: 8px; width: 8px; }
        .code-scroll::-webkit-scrollbar-track { background: #1e293b; }
        .code-scroll::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <!-- Navigation / Header -->
    <nav class="bg-white border-b border-slate-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center gap-3">
                    <div class="bg-blue-600 text-white p-2 rounded-lg font-bold">IA</div>
                    <div>
                        <h1 class="text-xl font-bold text-slate-900">Auditor√≠a Inteligente</h1>
                        <p class="text-xs text-slate-500">Dispensaci√≥n Farmac√©utica</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="scrollToSection('dashboard')" class="text-sm font-medium text-slate-600 hover:text-blue-600">Resultados</button>
                    <button onclick="scrollToSection('architecture')" class="text-sm font-medium text-slate-600 hover:text-blue-600">Arquitectura</button>
                    <button onclick="scrollToSection('tech-spec')" class="text-sm font-medium text-slate-600 hover:text-blue-600">Ingenier√≠a</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-12">

        <!-- Intro Section -->
        <section class="text-center max-w-3xl mx-auto">
            <h2 class="text-3xl font-extrabold text-slate-900 tracking-tight sm:text-4xl mb-4">Automatizaci√≥n de Control Documental</h2>
            <p class="text-lg text-slate-600">
                Soluci√≥n t√©cnica basada en IA Generativa y validaci√≥n transaccional (SAP HANA) para auditar soportes de entrega de medicamentos con alta precisi√≥n.
            </p>
        </section>

        <!-- SECTION 1: Dashboard & Results (Visualizing the Test Report) -->
        <!-- Visualization & Content Choices: 
             Goal: Inform & Compare. 
             Method: Interactive Donut Chart for status distribution + Dynamic Table for row-by-row analysis.
             Interaction: Clicking table rows highlights specific failure points.
             Justification: Immediate view of the "Test Results" provided in source.
        -->
        <section id="dashboard" class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
            <div class="p-6 border-b border-slate-100 flex justify-between items-center">
                <div>
                    <h3 class="text-lg font-bold text-slate-900">Resultados de Pruebas de Validaci√≥n</h3>
                    <p class="text-sm text-slate-500">An√°lisis en tiempo real de los documentos procesados</p>
                </div>
                <div class="flex gap-2">
                    <span class="px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">1 Aprobado</span>
                    <span class="px-3 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">1 Rechazado</span>
                    <span class="px-3 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">1 Revisi√≥n</span>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 p-6">
                <!-- Left: Charts -->
                <div class="lg:col-span-1 space-y-8">
                    <div class="bg-slate-50 p-4 rounded-xl">
                        <h4 class="text-sm font-semibold text-slate-700 mb-4 text-center">Distribuci√≥n de Estados</h4>
                        <div class="chart-container h-64">
                            <canvas id="statusChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-slate-50 p-4 rounded-xl">
                        <h4 class="text-sm font-semibold text-slate-700 mb-4 text-center">Nivel de Confianza IA</h4>
                        <div class="chart-container h-48">
                            <canvas id="confidenceChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Right: Detailed Table -->
                <div class="lg:col-span-2">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-slate-200">
                            <thead class="bg-slate-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Archivo / Pedido</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Hallazgos Clave</th>
                                    <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-slate-500 uppercase tracking-wider">Confianza</th>
                                    <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-slate-500 uppercase tracking-wider">Estado</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-slate-500 uppercase tracking-wider">Acci√≥n</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-slate-200" id="auditTableBody">
                                <!-- JS will populate this -->
                            </tbody>
                        </table>
                    </div>
                    <div id="rowDetailPanel" class="mt-4 p-4 bg-blue-50 rounded-lg border border-blue-100 hidden">
                        <h5 class="font-bold text-blue-800 text-sm mb-2">Detalle de An√°lisis IA: <span id="detailFileName"></span></h5>
                        <div class="grid grid-cols-2 md:grid-cols-5 gap-4 text-xs">
                            <div><span class="block text-slate-500">Firma</span><span id="detFirma" class="font-mono font-bold"></span></div>
                            <div><span class="block text-slate-500">C√©dula</span><span id="detCedula" class="font-mono font-bold"></span></div>
                            <div><span class="block text-slate-500">Medicamento</span><span id="detMed" class="font-mono font-bold"></span></div>
                            <div><span class="block text-slate-500">Fecha</span><span id="detFecha" class="font-mono font-bold"></span></div>
                            <div><span class="block text-slate-500">Cantidad</span><span id="detCant" class="font-mono font-bold"></span></div>
                        </div>
                        <p id="detObs" class="mt-3 text-sm text-slate-700 italic"></p>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 2: Interactive Architecture (Explaining the Flow) -->
        <!-- Visualization Choice: 
             Goal: Explain Process/Structure.
             Method: Vertical interactive stepper list on left, Detail card on right.
             Interaction: Click step to reveal technical details (Logic, Tools used).
             Justification: Translates the Mermaid diagram into a user-friendly exploration flow. NO SVG used.
        -->
        <section id="architecture">
            <div class="mb-6">
                <h3 class="text-2xl font-bold text-slate-900">Arquitectura de Flujo</h3>
                <p class="text-slate-600">Orquestaci√≥n en Copilot Studio & Power Automate con validaci√≥n cruzada SAP HANA.</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
                <!-- Flow Steps List -->
                <div class="md:col-span-4 space-y-3" id="flowStepsContainer">
                    <!-- Generated by JS -->
                </div>

                <!-- Step Detail View -->
                <div class="md:col-span-8">
                    <div class="bg-white p-8 rounded-2xl shadow-lg border border-slate-200 h-full flex flex-col justify-center transition-all" id="flowDetailCard">
                        <div class="text-center text-slate-400">
                            <p>Selecciona un paso del flujo para ver los detalles t√©cnicos.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 3: Engineering Spec (Prompt & JSON) -->
        <!-- Visualization Choice: 
             Goal: Show Technical Depth.
             Method: Tabbed Code Viewer.
             Interaction: Switch between "System Prompt" and "JSON Schema".
             Justification: Directly displays the core intellectual property defined in the source report.
        -->
        <section id="tech-spec" class="bg-slate-900 rounded-2xl shadow-lg overflow-hidden text-slate-300">
            <div class="flex border-b border-slate-700 bg-slate-800">
                <button class="tab-btn px-6 py-4 text-sm font-medium hover:text-white hover:bg-slate-700 transition-colors active" onclick="switchTab('prompt')">System Prompt (Few-Shot)</button>
                <button class="tab-btn px-6 py-4 text-sm font-medium hover:text-white hover:bg-slate-700 transition-colors" onclick="switchTab('json')">JSON Schema (Output)</button>
            </div>
            
            <div class="relative group">
                <!-- Copy Button placeholder -->
                <div class="absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity">
                    <span class="text-xs bg-slate-700 px-2 py-1 rounded text-slate-400">Solo Lectura</span>
                </div>

                <div id="tab-prompt" class="p-6 overflow-x-auto code-scroll h-96">
<pre class="font-mono text-sm leading-relaxed text-blue-300">
<span class="text-purple-400"># ROL</span>
Eres "AuditorIA", un experto en validaci√≥n documental farmac√©utica de COLSUBSIDIO. Tu trabajo es infalible verificando requisitos legales en soportes de entrega de medicamentos.

<span class="text-purple-400"># CONTEXTO</span>
Recibir√°s el texto extra√≠do (OCR) de un documento de facturaci√≥n. Debes localizar EXCLUSIVAMENTE la secci√≥n denominada "DISPENSACION" (o tirilla de entrega) y verificar 5 puntos cr√≠ticos.

<span class="text-purple-400"># REGLAS DE NEGOCIO</span>
1. <span class="text-yellow-300">FIRMA:</span> Busca rastros de escritura manual o etiquetas [FIRMA], [RECIBIDO]. Si el espacio est√° en blanco, es "NO".
2. <span class="text-yellow-300">C√âDULA:</span> Debe tener formato num√©rico v√°lido. "CC" sin n√∫meros no cuenta.
3. <span class="text-yellow-300">MEDICAMENTO:</span> Debe coincidir con el √≠tem facturado.
4. <span class="text-yellow-300">FECHA:</span> Formato DD/MM/AAAA.
5. <span class="text-yellow-300">CANTIDAD:</span> N√∫mero expl√≠cito junto a unidad (Caja, Tab, Unid).

<span class="text-purple-400"># FORMATO DE RESPUESTA (JSON STRICT)</span>
Debes responder √öNICAMENTE con un objeto JSON.

<span class="text-purple-400"># EJEMPLOS (FEW-SHOT LEARNING)</span>
Usuario: "Texto extra√≠do: ... Dispensaci√≥n: Concor 5mg, Cant: 30, CC 12345, Firma: [Garabato] ..."
Asistente: { "cumplimiento_general": "APROBADO", "score_confianza": 0.95, ... }
</pre>
                </div>

                <div id="tab-json" class="p-6 overflow-x-auto code-scroll h-96 hidden">
<pre class="font-mono text-sm leading-relaxed text-green-300">
{
  "type": "object",
  "properties": {
    "nombre_archivo": { "type": "string" },
    "numero_pedido": { "type": "string" },
    "auditoria": {
      "type": "object",
      "properties": {
        "firma_presente": { "type": "boolean" },
        "cedula_valida": { "type": "boolean" },
        "medicamento_correcto": { "type": "boolean" },
        "fecha_registro": { "type": "boolean" },
        "cantidad_correcta": { "type": "boolean" }
      }
    },
    "estado_final": { 
      "type": "string", 
      "enum": ["APROBADO", "RECHAZADO", "REVISION"] 
    },
    "razon_rechazo": { "type": "string" }
  }
}
</pre>
                </div>
            </div>
        </section>

        <!-- SECTION 4: Business Impact KPIs -->
        <!-- Visualization Choice: 
             Goal: Monitor/Impact.
             Method: Bar Chart comparison.
             Justification: Shows the efficiency gains mentioned in the advanced architecture notes.
        -->
        <section class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                <h3 class="text-lg font-bold text-slate-900 mb-4">Eficiencia Operativa Estimada</h3>
                <div class="chart-container">
                    <canvas id="efficiencyChart"></canvas>
                </div>
                <p class="text-xs text-center text-slate-500 mt-2">Reducci√≥n del 85% en tiempo de procesamiento por documento.</p>
            </div>
            
            <div class="bg-blue-600 p-8 rounded-2xl shadow-sm text-white flex flex-col justify-center">
                <h3 class="text-2xl font-bold mb-4">Impacto del Negocio</h3>
                <ul class="space-y-4">
                    <li class="flex items-start">
                        <span class="text-2xl mr-3">üõ°Ô∏è</span>
                        <div>
                            <strong class="block text-lg">Detecci√≥n de Fraude</strong>
                            <span class="text-blue-100 text-sm">Validaci√≥n cruzada con SAP HANA elimina pedidos inexistentes antes de la auditor√≠a visual.</span>
                        </div>
                    </li>
                    <li class="flex items-start">
                        <span class="text-2xl mr-3">‚ö°</span>
                        <div>
                            <strong class="block text-lg">Velocidad</strong>
                            <span class="text-blue-100 text-sm">Procesamiento 24/7 sin fatiga operativa.</span>
                        </div>
                    </li>
                    <li class="flex items-start">
                        <span class="text-2xl mr-3">üß†</span>
                        <div>
                            <strong class="block text-lg">Aprendizaje Continuo</strong>
                            <span class="text-blue-100 text-sm">Feedback Loop (Human-in-the-loop) mejora la precisi√≥n del modelo en cada iteraci√≥n.</span>
                        </div>
                    </li>
                </ul>
            </div>
        </section>

    </main>

    <footer class="bg-slate-50 border-t border-slate-200 py-8 mt-12">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-slate-400 text-sm">Soluci√≥n dise√±ada para Prueba Ingeniero IA Colsubsidio.</p>
        </div>
    </footer>

    <!-- LOGIC SCRIPT -->
    <script>
        // --- DATA SOURCE (From Report) ---
        const auditData = [
            {
                file: "3153711068.pdf",
                order: "39413688",
                med: "C-GLIMEPIRIDA 2MG",
                qty: "15 TAB",
                checks: { firma: true, cedula: true, med: true, fecha: true, cant: true },
                confidence: 98,
                status: "APROBADO",
                action: "Archivar",
                obs: "Documento cumple con todos los criterios."
            },
            {
                file: "3153711625.pdf",
                order: "32288516",
                med: "C-CONCOR 5MG",
                qty: "30 TAB",
                checks: { firma: false, cedula: "partial", med: true, fecha: true, cant: true },
                confidence: 85,
                status: "RECHAZADO",
                action: "Devoluci√≥n",
                obs: "Firma ausente y C√©dula incompleta. Requiere correcci√≥n en punto de venta."
            },
            {
                file: "3153773536.pdf",
                order: "71648983",
                med: "C-TRAYENTA 5MG",
                qty: "30 TAB",
                checks: { firma: true, cedula: true, med: true, fecha: false, cant: true },
                confidence: 72,
                status: "REVISION",
                action: "Validaci√≥n Manual",
                obs: "Fecha no legible por calidad de impresi√≥n. Validar tirilla f√≠sica."
            }
        ];

        const flowSteps = [
            {
                id: "step1",
                title: "1. Trigger SharePoint",
                icon: "üìÇ",
                desc: "Monitoriza la carpeta 'Facturas_Pendientes'. Se activa al cargar un nuevo PDF.",
                tech: "Conector SharePoint (When a file is created)",
                action: "Inicia el flujo y descarga el contenido en Base64."
            },
            {
                id: "step2",
                title: "2. Extracci√≥n OCR",
                icon: "üëÅÔ∏è",
                desc: "AI Builder extrae texto crudo y coordenadas. Identifica zona 'DISPENSACION'.",
                tech: "AI Builder (Document Intelligence)",
                action: "Genera texto estructurado para el LLM."
            },
            {
                id: "step3",
                title: "3. Validaci√≥n SAP HANA",
                icon: "üíæ",
                desc: "Consulta la existencia del 'N√∫mero de Pedido' en la base de datos corporativa.",
                tech: "SAP Connector / SQL Query",
                action: "Si Pedido = Null ‚Üí Rechazo Inmediato (Fraude/Error). Si Existe ‚Üí Contin√∫a."
            },
            {
                id: "step4",
                title: "4. An√°lisis IA (Copilot)",
                icon: "ü§ñ",
                desc: "GPT-4o analiza el texto OCR usando el Prompt de Auditor√≠a con reglas de negocio.",
                tech: "Copilot Studio (Generative Node)",
                action: "Eval√∫a Firma, C√©dula, Fecha, Cantidad. Calcula Score de Confianza."
            },
            {
                id: "step5",
                title: "5. L√≥gica de Decisi√≥n",
                icon: "‚öñÔ∏è",
                desc: "Motor de reglas basado en el Score de Confianza y validaciones booleanas.",
                tech: "Power Automate Conditionals",
                action: ">90%: Aprobar | 60-89%: Revisi√≥n Humana | <60%: Rechazar."
            },
            {
                id: "step6",
                title: "6. Salida y Acci√≥n",
                icon: "üì§",
                desc: "Ejecuci√≥n de la acci√≥n final seg√∫n el estado.",
                tech: "Excel Online / Teams / Outlook",
                action: "Actualiza Excel, mueve archivo en SharePoint, notifica al auditor."
            }
        ];

        // --- DOM MANIPULATION ---

        function renderAuditTable() {
            const tbody = document.getElementById('auditTableBody');
            tbody.innerHTML = '';

            auditData.forEach((row, index) => {
                const tr = document.createElement('tr');
                tr.className = "hover:bg-slate-50 cursor-pointer transition-colors";
                tr.onclick = () => showRowDetails(index);
                
                let statusColor = "";
                let statusIcon = "";
                if(row.status === 'APROBADO') { statusColor = "bg-green-100 text-green-800"; statusIcon = "‚úÖ"; }
                else if(row.status === 'RECHAZADO') { statusColor = "bg-red-100 text-red-800"; statusIcon = "‚ùå"; }
                else { statusColor = "bg-yellow-100 text-yellow-800"; statusIcon = "‚ö†Ô∏è"; }

                tr.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-slate-900">${row.file}</div>
                        <div class="text-xs text-slate-500">Ped: ${row.order}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-slate-700">${row.med}</div>
                        <div class="text-xs text-slate-500">${row.qty}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-center">
                        <div class="text-sm font-bold text-slate-700">${row.confidence}%</div>
                        <div class="w-full bg-slate-200 rounded-full h-1.5 mt-1">
                            <div class="bg-blue-600 h-1.5 rounded-full" style="width: ${row.confidence}%"></div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-center">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusColor}">
                            ${row.status}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium text-slate-600">
                        ${row.action}
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function showRowDetails(index) {
            const data = auditData[index];
            document.getElementById('rowDetailPanel').classList.remove('hidden');
            document.getElementById('detailFileName').textContent = data.file;
            document.getElementById('detObs').textContent = "Observaci√≥n: " + data.obs;
            
            // Helper to format check status
            const formatCheck = (val) => {
                if(val === true) return '<span class="text-green-600">Correcto</span>';
                if(val === false) return '<span class="text-red-600">Falta</span>';
                return '<span class="text-yellow-600">Parcial/Ilegible</span>';
            };

            document.getElementById('detFirma').innerHTML = formatCheck(data.checks.firma);
            document.getElementById('detCedula').innerHTML = formatCheck(data.checks.cedula);
            document.getElementById('detMed').innerHTML = formatCheck(data.checks.med);
            document.getElementById('detFecha').innerHTML = formatCheck(data.checks.fecha);
            document.getElementById('detCant').innerHTML = formatCheck(data.checks.cant);
        }

        function renderFlowSteps() {
            const container = document.getElementById('flowStepsContainer');
            container.innerHTML = '';
            
            flowSteps.forEach((step, idx) => {
                const div = document.createElement('div');
                div.className = `step-card p-4 bg-white rounded-xl border border-slate-200 shadow-sm flex items-center justify-between ${idx===0 ? 'active' : ''}`;
                div.onclick = () => activateStep(idx, div);
                div.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div class="bg-blue-50 text-blue-600 w-10 h-10 rounded-full flex items-center justify-center text-lg shadow-sm">
                            ${step.icon}
                        </div>
                        <div>
                            <h4 class="font-bold text-slate-800 text-sm">${step.title}</h4>
                            <p class="text-xs text-slate-500 truncate w-48">${step.tech}</p>
                        </div>
                    </div>
                    <span class="text-slate-300 text-lg">‚Üí</span>
                `;
                container.appendChild(div);
            });
            activateStep(0, container.children[0]); // Init first step
        }

        function activateStep(idx, element) {
            // Remove active class from all
            document.querySelectorAll('.step-card').forEach(el => el.classList.remove('active', 'border-l-blue-500'));
            // Add to current
            element.classList.add('active');
            
            // Update Detail Card
            const step = flowSteps[idx];
            const detailCard = document.getElementById('flowDetailCard');
            detailCard.innerHTML = `
                <div class="flex items-start gap-4 mb-6">
                    <div class="bg-blue-600 text-white w-16 h-16 rounded-2xl flex items-center justify-center text-3xl shadow-lg">
                        ${step.icon}
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-slate-900">${step.title}</h3>
                        <span class="inline-block bg-slate-100 text-slate-600 text-xs px-2 py-1 rounded mt-1 font-mono">${step.tech}</span>
                    </div>
                </div>
                
                <div class="space-y-6">
                    <div>
                        <h5 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">Descripci√≥n del Proceso</h5>
                        <p class="text-slate-700 leading-relaxed">${step.desc}</p>
                    </div>
                    
                    <div class="bg-slate-50 p-4 rounded-lg border border-slate-100">
                        <h5 class="text-xs font-bold text-blue-600 uppercase tracking-wider mb-2">Acci√≥n Automatizada</h5>
                        <p class="text-sm text-slate-600">${step.action}</p>
                    </div>
                </div>
            `;
        }

        function switchTab(tabId) {
            // UI Toggle
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active', 'border-b-2', 'border-blue-600', 'text-blue-600'));
            event.target.classList.add('active', 'border-b-2', 'border-blue-600', 'text-blue-600');
            
            // Content Toggle
            document.getElementById('tab-prompt').classList.add('hidden');
            document.getElementById('tab-json').classList.add('hidden');
            document.getElementById('tab-' + tabId).classList.remove('hidden');
        }

        function scrollToSection(id) {
            document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
        }

        // --- CHARTS INITIALIZATION ---
        function initCharts() {
            // 1. Status Distribution (Donut)
            const ctxStatus = document.getElementById('statusChart').getContext('2d');
            new Chart(ctxStatus, {
                type: 'doughnut',
                data: {
                    labels: ['Aprobado', 'Rechazado', 'Revisi√≥n'],
                    datasets: [{
                        data: [1, 1, 1],
                        backgroundColor: ['#22c55e', '#ef4444', '#eab308'],
                        borderWidth: 0,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { usePointStyle: true, font: {size: 11} } }
                    }
                }
            });

            // 2. Confidence Levels (Bar)
            const ctxConf = document.getElementById('confidenceChart').getContext('2d');
            new Chart(ctxConf, {
                type: 'bar',
                data: {
                    labels: ['Doc 1', 'Doc 2', 'Doc 3'],
                    datasets: [{
                        label: 'Score Confianza %',
                        data: [98, 85, 72],
                        backgroundColor: '#3b82f6',
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true, max: 100, grid: { display: false } },
                        x: { grid: { display: false } }
                    },
                    plugins: { legend: { display: false } }
                }
            });

            // 3. Efficiency (Bar - Horizontal)
            const ctxEff = document.getElementById('efficiencyChart').getContext('2d');
            new Chart(ctxEff, {
                type: 'bar',
                data: {
                    labels: ['Auditor√≠a Manual', 'Auditor√≠a IA'],
                    datasets: [{
                        label: 'Tiempo Promedio (min/doc)',
                        data: [15, 2], // Simulated data based on efficiency assumption
                        backgroundColor: ['#94a3b8', '#3b82f6'],
                        borderRadius: 4,
                        barThickness: 30
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { x: { beginAtZero: true, title: {display: true, text: 'Minutos'} } },
                    plugins: { legend: { display: false } }
                }
            });
        }

        // --- INIT ---
        window.addEventListener('DOMContentLoaded', () => {
            renderAuditTable();
            renderFlowSteps();
            initCharts();
        });

    </script>
</body>
</html>